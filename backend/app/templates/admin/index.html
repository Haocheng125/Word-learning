{% extends "admin/base.html" %}

{% block title %}é¦–é¡µ{% endblock %}

{% block extra_css %}
<style>
    .admin-form {
        max-width: 500px;
        margin: 0 auto;
    }
    
    .admin-form .form-group {
        margin-bottom: 1rem;
    }
    
    .admin-form label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .admin-form input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }
    
    .admin-form input:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .alert {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }
    
    .alert-error {
        background: #fee;
        color: #c0392b;
        border: 1px solid #fcc;
    }
    
    .alert-success {
        background: #efe;
        color: #27ae60;
        border: 1px solid #cfc;
    }
    
    .hidden {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div style="text-align: center; padding: 2rem 0;">
    <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">ğŸ“š å•è¯å­¦ä¹ ç³»ç»Ÿç®¡ç†åå°</h1>
    <p style="font-size: 1.2rem; color: #7f8c8d; margin-bottom: 2rem;">æ¬¢è¿ä½¿ç”¨åå°ç®¡ç†ç³»ç»Ÿ</p>
</div>

<!-- ç»Ÿè®¡æ•°æ®å¡ç‰‡ -->
<div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 2rem;">
    <div class="stat-card">
        <h3>ğŸ“– æ€»è¯åº“æ•°é‡</h3>
        <div class="number">{{ total_wordbooks }}</div>
        <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 0.5rem;">å·²ä¸Šæ¶: {{ active_wordbooks }}</p>
    </div>
    
    <div class="stat-card">
        <h3>ğŸ‘¥ ç”¨æˆ·æ•°é‡</h3>
        <div class="number">{{ total_users }}</div>
        <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 0.5rem;">æ³¨å†Œç”¨æˆ·æ€»æ•°</p>
    </div>
    
    <div class="stat-card">
        <h3>ğŸ“ æ€»å•è¯æ•°</h3>
        <div class="number">{{ total_words }}</div>
        <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 0.5rem;">æ‰€æœ‰è¯åº“å•è¯æ€»æ•°</p>
    </div>
</div>

<!-- åŠŸèƒ½å¿«æ·å…¥å£ -->
<div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
    <div class="stat-card">
        <h3>ğŸ“– ç®¡ç†è¯åº“</h3>
        <p style="margin: 1rem 0;">æŸ¥çœ‹ã€ä¸Šæ¶/ä¸‹æ¶å’Œåˆ é™¤è¯åº“</p>
        <a href="/admin/wordbooks" class="btn btn-primary">è¯åº“ç®¡ç†</a>
    </div>
    
    <div class="stat-card">
        <h3>ğŸ“¤ ä¸Šä¼ è¯åº“</h3>
        <p style="margin: 1rem 0;">ä¸Šä¼  Excel æˆ– PDF æ–‡ä»¶å¹¶è‡ªåŠ¨è§£æåˆ›å»ºè¯åº“</p>
        <a href="/admin/upload" class="btn btn-success">å¼€å§‹ä¸Šä¼ </a>
    </div>
</div>

<!-- ç®¡ç†å‘˜ç®¡ç† -->
<div class="card">
    <h2>ğŸ” æ·»åŠ å‰¯ç®¡ç†å‘˜</h2>
    <p style="color: #7f8c8d; margin-bottom: 1rem;">åªæœ‰ä¸»ç®¡ç†å‘˜å¯ä»¥æ·»åŠ å‰¯ç®¡ç†å‘˜è´¦å·</p>
    
    <div id="alert-error" class="alert alert-error hidden"></div>
    <div id="alert-success" class="alert alert-success hidden"></div>
    
    <form id="add-admin-form" class="admin-form">
        <div class="form-group">
            <label for="admin-key">ç®¡ç†å‘˜å¯†é’¥</label>
            <input 
                type="text" 
                id="admin-key" 
                name="admin_key" 
                placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†é’¥"
                required
            />
        </div>
        
        <div class="form-group">
            <label for="username">ç”¨æˆ·å</label>
            <input 
                type="text" 
                id="username" 
                name="username" 
                placeholder="è¯·è¾“å…¥å‰¯ç®¡ç†å‘˜ç”¨æˆ·å"
                required
            />
        </div>
        
        <div class="form-group">
            <label for="email">é‚®ç®±</label>
            <input 
                type="email" 
                id="email" 
                name="email" 
                placeholder="è¯·è¾“å…¥å‰¯ç®¡ç†å‘˜é‚®ç®±"
                required
            />
        </div>
        
        <div class="form-group">
            <label for="password">å¯†ç </label>
            <input 
                type="password" 
                id="password" 
                name="password" 
                placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
                required
                minlength="6"
            />
        </div>
        
        <button type="submit" class="btn" id="add-admin-btn">
            æ·»åŠ å‰¯ç®¡ç†å‘˜
        </button>
    </form>
</div>

<div class="card">
    <h2>âœ¨ åŠŸèƒ½è¯´æ˜</h2>
    <ul style="line-height: 2;">
        <li><strong>è¯åº“ç®¡ç†</strong>ï¼šæŸ¥çœ‹æ‰€æœ‰è¯åº“åˆ—è¡¨ï¼Œå¯ä»¥ä¸Šæ¶/ä¸‹æ¶ã€åˆ é™¤å’Œä¸‹è½½è¯åº“</li>
        <li><strong>ä¸Šæ¶/ä¸‹æ¶</strong>ï¼šæ§åˆ¶è¯åº“æ˜¯å¦åœ¨å‰ç«¯æ˜¾ç¤ºï¼Œåªæœ‰å·²ä¸Šæ¶çš„è¯åº“ç”¨æˆ·æ‰èƒ½çœ‹åˆ°</li>
        <li><strong>ä¸Šä¼ è¯åº“</strong>ï¼šä¸Šä¼  Excel æˆ– PDF æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æå¹¶åˆ›å»ºè¯åº“ï¼ˆé»˜è®¤ä¸‹æ¶çŠ¶æ€ï¼‰</li>
        <li><strong>ä¸‹è½½è¯åº“</strong>ï¼šå¯ä»¥ä¸‹è½½åŸå§‹çš„ Excel æ–‡ä»¶</li>
        <li><strong>ç®¡ç†å‘˜ç®¡ç†</strong>ï¼šä¸»ç®¡ç†å‘˜å¯ä»¥é€šè¿‡å¯†é’¥æ·»åŠ å‰¯ç®¡ç†å‘˜è´¦å·</li>
    </ul>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('add-admin-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const adminKey = document.getElementById('admin-key').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const addAdminBtn = document.getElementById('add-admin-btn');
        const alertError = document.getElementById('alert-error');
        const alertSuccess = document.getElementById('alert-success');
        
        if (!adminKey || !username || !email || !password) {
            showAlert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
            return;
        }
        
        if (password.length < 6) {
            showAlert('å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦', 'error');
            return;
        }
        
        addAdminBtn.disabled = true;
        addAdminBtn.textContent = 'æ·»åŠ ä¸­...';
        
        try {
            const response = await fetch('/admin/api/admin/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    admin_key: adminKey,
                    username: username,
                    email: email,
                    password: password
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showAlert('å‰¯ç®¡ç†å‘˜æ·»åŠ æˆåŠŸï¼', 'success');
                document.getElementById('add-admin-form').reset();
            } else {
                showAlert(data.message || 'æ·»åŠ å¤±è´¥', 'error');
            }
        } catch (error) {
            showAlert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•', 'error');
        } finally {
            addAdminBtn.disabled = false;
            addAdminBtn.textContent = 'æ·»åŠ å‰¯ç®¡ç†å‘˜';
        }
    });
    
    function showAlert(message, type) {
        const alertError = document.getElementById('alert-error');
        const alertSuccess = document.getElementById('alert-success');
        
        if (type === 'error') {
            alertError.textContent = message;
            alertError.classList.remove('hidden');
            alertSuccess.classList.add('hidden');
        } else {
            alertSuccess.textContent = message;
            alertSuccess.classList.remove('hidden');
            alertError.classList.add('hidden');
        }
        
        setTimeout(() => {
            alertError.classList.add('hidden');
            alertSuccess.classList.add('hidden');
        }, 5000);
    }
</script>
{% endblock %}
