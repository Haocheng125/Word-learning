{% extends "admin/base.html" %}

{% block title %}è¯åº“ç®¡ç†{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>ğŸ“– è¯åº“ç®¡ç†</h1>
    <a href="/admin/upload" class="btn btn-success">+ ä¸Šä¼ æ–°è¯åº“</a>
</div>

<div class="card">
    {% if wordbooks %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>åç§°</th>
                <th>æè¿°</th>
                <th>å•è¯æ•°</th>
                <th>çŠ¶æ€</th>
                <th>æ–‡ä»¶å</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for wb in wordbooks %}
            <tr>
                <td>{{ wb.id }}</td>
                <td><strong>{{ wb.name }}</strong></td>
                <td>{{ (wb.description or '')[:50] }}{% if (wb.description or '')|length > 50 %}...{% endif %}</td>
                <td><strong>{{ wb.word_count }}</strong></td>
                <td>
                    {% if wb.is_active %}
                        <span style="color: #27ae60; font-weight: bold;">âœ… å·²ä¸Šæ¶</span>
                    {% else %}
                        <span style="color: #e74c3c; font-weight: bold;">âŒ å·²ä¸‹æ¶</span>
                    {% endif %}
                </td>
                <td>{{ wb.pdf_filename or 'æ— ' }}</td>
                <td>{{ wb.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    <a href="/admin/wordbooks/{{ wb.id }}/words" class="btn" style="background: #3498db;">ğŸ“‹ æŸ¥çœ‹å•è¯</a>
                    <button class="btn" style="background: {% if wb.is_active %}#e67e22{% else %}#27ae60{% endif %};" 
                            onclick="toggleStatus({{ wb.id }}, {{ wb.is_active|lower }})">
                        {% if wb.is_active %}ğŸ”» ä¸‹æ¶{% else %}ğŸ”º ä¸Šæ¶{% endif %}
                    </button>
                    <button class="btn btn-danger" onclick="deleteWordbook({{ wb.id }}, '{{ wb.name }}')"> ğŸ—‘ï¸ åˆ é™¤</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if pagination.has_prev or pagination.has_next %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="?page={{ pagination.prev_num }}">ä¸Šä¸€é¡µ</a>
        {% endif %}
        
        <span style="padding: 0.5rem 1rem;">ç¬¬ {{ pagination.page }} / {{ pagination.pages }} é¡µ</span>
        
        {% if pagination.has_next %}
        <a href="?page={{ pagination.next_num }}">ä¸‹ä¸€é¡µ</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <p>æš‚æ— è¯åº“æ•°æ®ï¼Œ<a href="/admin/upload">ç‚¹å‡»ä¸Šä¼ </a>ç¬¬ä¸€ä¸ªè¯åº“</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleStatus(id, currentStatus) {
    const action = currentStatus ? 'ä¸‹æ¶' : 'ä¸Šæ¶';
    if (!confirm(`ç¡®å®šè¦${action}æ­¤è¯åº“å—ï¼Ÿ`)) {
        return;
    }
    
    fetch(`/admin/api/wordbooks/${id}/toggle`, {
        method: 'POST'
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('æ“ä½œå¤±è´¥ï¼š' + data.message);
        }
    })
    .catch(err => {
        alert('æ“ä½œå¤±è´¥ï¼š' + err.message);
    });
}

function deleteWordbook(id, name) {
    if (!confirm(`ç¡®å®šè¦åˆ é™¤è¯åº“"${name}"å—ï¼Ÿæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰ç›¸å…³å•è¯å’Œå­¦ä¹ è¿›åº¦ï¼`)) {
        return;
    }
    
    fetch(`/admin/api/wordbooks/${id}`, {
        method: 'DELETE'
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert('åˆ é™¤æˆåŠŸ');
            location.reload();
        } else {
            alert('åˆ é™¤å¤±è´¥ï¼š' + data.message);
        }
    })
    .catch(err => {
        alert('åˆ é™¤å¤±è´¥ï¼š' + err.message);
    });
}
</script>
{% endblock %}
